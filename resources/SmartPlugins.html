

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Smart Plugins &mdash; Pyrogram Documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  
    <link rel="canonical" href="https://docs.pyrogram.ml/resources/SmartPlugins.html"/>
  

  

  
  
    

  

  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Auto Authorization" href="AutoAuthorization.html" />
    <link rel="prev" title="Configuration File" href="ConfigurationFile.html" />
    <meta property="og:title" content="Welcome to Pyrogram — Pyrogram Documentation">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://i.imgur.com/4E0uKSE.png">
    <meta property="og:url" content="https://docs.pyrogram.ml">
    <meta property="og:description" content="Telegram MTProto API Client Library for Python">
    <meta property="og:site_name" content="Pyrogram">
    <meta property="og:locale" content="en_US">

    <meta name="description" content="Telegram MTProto API Client Library for Python">
    <meta name="theme-color" content="#5c5a55">

    <link href="https://fonts.googleapis.com/css?family=Lato:400,400i,700,700i|Roboto+Slab:400" rel="stylesheet">

    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-84734363-2"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }

        gtag('js', new Date());

        gtag('config', 'UA-84734363-2');
    </script>

  
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                version 0.12.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Quick Start</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../start/Installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../start/Installation.html#install-pyrogram">Install Pyrogram</a></li>
<li class="toctree-l2"><a class="reference internal" href="../start/Installation.html#bleeding-edge">Bleeding Edge</a></li>
<li class="toctree-l2"><a class="reference internal" href="../start/Installation.html#asynchronous">Asynchronous</a></li>
<li class="toctree-l2"><a class="reference internal" href="../start/Installation.html#verifying">Verifying</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../start/Setup.html">Setup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../start/Setup.html#api-keys">API Keys</a></li>
<li class="toctree-l2"><a class="reference internal" href="../start/Setup.html#configuration">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../start/Setup.html#user-authorization">User Authorization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../start/Setup.html#bot-authorization">Bot Authorization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../start/Usage.html">Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../start/Usage.html#high-level-api">High-level API</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Resources</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="UpdateHandling.html">Update Handling</a><ul>
<li class="toctree-l2"><a class="reference internal" href="UpdateHandling.html#registering-an-handler">Registering an Handler</a></li>
<li class="toctree-l2"><a class="reference internal" href="UpdateHandling.html#using-add-handler">Using add_handler()</a></li>
<li class="toctree-l2"><a class="reference internal" href="UpdateHandling.html#using-decorators">Using Decorators</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="UsingFilters.html">Using Filters</a><ul>
<li class="toctree-l2"><a class="reference internal" href="UsingFilters.html#combining-filters">Combining Filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="UsingFilters.html#advanced-filters">Advanced Filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="UsingFilters.html#custom-filters">Custom Filters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="UsingFilters.html#basic-filters">Basic Filters</a></li>
<li class="toctree-l3"><a class="reference internal" href="UsingFilters.html#filters-with-arguments">Filters with Arguments</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="MoreOnUpdates.html">More on Updates</a><ul>
<li class="toctree-l2"><a class="reference internal" href="MoreOnUpdates.html#handler-groups">Handler Groups</a></li>
<li class="toctree-l2"><a class="reference internal" href="MoreOnUpdates.html#update-propagation">Update propagation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="MoreOnUpdates.html#stop-propagation">Stop Propagation</a></li>
<li class="toctree-l3"><a class="reference internal" href="MoreOnUpdates.html#continue-propagation">Continue Propagation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ConfigurationFile.html">Configuration File</a><ul>
<li class="toctree-l2"><a class="reference internal" href="ConfigurationFile.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="ConfigurationFile.html#the-config-ini-file">The config.ini File</a></li>
<li class="toctree-l2"><a class="reference internal" href="ConfigurationFile.html#configuration-sections">Configuration Sections</a><ul>
<li class="toctree-l3"><a class="reference internal" href="ConfigurationFile.html#pyrogram">Pyrogram</a></li>
<li class="toctree-l3"><a class="reference internal" href="ConfigurationFile.html#proxy">Proxy</a></li>
<li class="toctree-l3"><a class="reference internal" href="ConfigurationFile.html#plugins">Plugins</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Smart Plugins</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-smart-plugins">Using Smart Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="#specifying-the-plugins-to-include">Specifying the Plugins to include</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#load-unload-plugins-at-runtime">Load/Unload Plugins at Runtime</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#unloading">Unloading</a></li>
<li class="toctree-l3"><a class="reference internal" href="#loading">Loading</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="AutoAuthorization.html">Auto Authorization</a><ul>
<li class="toctree-l2"><a class="reference internal" href="AutoAuthorization.html#log-in">Log In</a></li>
<li class="toctree-l2"><a class="reference internal" href="AutoAuthorization.html#sign-up">Sign Up</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="CustomizeSessions.html">Customize Sessions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="CustomizeSessions.html#set-custom-values">Set Custom Values</a></li>
<li class="toctree-l2"><a class="reference internal" href="CustomizeSessions.html#set-custom-languages">Set Custom Languages</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="TgCrypto.html">Fast Crypto</a><ul>
<li class="toctree-l2"><a class="reference internal" href="TgCrypto.html#installation">Installation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="TextFormatting.html">Text Formatting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="TextFormatting.html#markdown-style">Markdown Style</a></li>
<li class="toctree-l2"><a class="reference internal" href="TextFormatting.html#html-style">HTML Style</a></li>
<li class="toctree-l2"><a class="reference internal" href="TextFormatting.html#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="SOCKS5Proxy.html">SOCKS5 Proxy</a><ul>
<li class="toctree-l2"><a class="reference internal" href="SOCKS5Proxy.html#usage">Usage</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="BotsInteraction.html">Bots Interaction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="BotsInteraction.html#inline-bots">Inline Bots</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ErrorHandling.html">Error Handling</a><ul>
<li class="toctree-l2"><a class="reference internal" href="ErrorHandling.html#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="TestServers.html">Test Servers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="TestServers.html#test-mode-in-official-apps">Test Mode in Official Apps</a></li>
<li class="toctree-l2"><a class="reference internal" href="TestServers.html#test-numbers">Test Numbers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="AdvancedUsage.html">Advanced Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="AdvancedUsage.html#telegram-raw-api">Telegram Raw API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="AdvancedUsage.html#invoking-functions">Invoking Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="AdvancedUsage.html#chat-ids">Chat IDs</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="VoiceCalls.html">Voice Calls</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog.html">Changelog</a></li>
</ul>
<p class="caption"><span class="caption-text">Main Package</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../pyrogram/index.html">Pyrogram</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../pyrogram/Client.html">Client</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../pyrogram/Client.html#utilities">Utilities</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pyrogram/Client.html#decorators">Decorators</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pyrogram/Client.html#messages">Messages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pyrogram/Client.html#chats">Chats</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pyrogram/Client.html#users">Users</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pyrogram/Client.html#contacts">Contacts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pyrogram/Client.html#password">Password</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pyrogram/Client.html#bots">Bots</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../pyrogram/Types.html">Types</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../pyrogram/Types.html#users-chats">Users &amp; Chats</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pyrogram/Types.html#messages-media">Messages &amp; Media</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pyrogram/Types.html#bots">Bots</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pyrogram/Types.html#input-media">Input Media</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pyrogram/Types.html#inline-mode">Inline Mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pyrogram/Types.html#inputmessagecontent">InputMessageContent</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../pyrogram/Handlers.html">Handlers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pyrogram/Filters.html">Filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pyrogram/ChatAction.html">ChatAction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pyrogram/ParseMode.html">ParseMode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pyrogram/RPCError.html">RPCError</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../errors/SeeOther.html">303 - See Other</a></li>
<li class="toctree-l3"><a class="reference internal" href="../errors/BadRequest.html">400 - Bad Request</a></li>
<li class="toctree-l3"><a class="reference internal" href="../errors/Unauthorized.html">401 - Unauthorized</a></li>
<li class="toctree-l3"><a class="reference internal" href="../errors/Forbidden.html">403 - Forbidden</a></li>
<li class="toctree-l3"><a class="reference internal" href="../errors/NotAcceptable.html">406 - Not Acceptable</a></li>
<li class="toctree-l3"><a class="reference internal" href="../errors/Flood.html">420 - Flood</a></li>
<li class="toctree-l3"><a class="reference internal" href="../errors/InternalServerError.html">500 - Internal Server Error</a></li>
<li class="toctree-l3"><a class="reference internal" href="../errors/UnknownError.html">520 - Unknown Error</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Telegram API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../functions/index.html">Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../types/index.html">Types</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Pyrogram</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Smart Plugins</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="https://github.com/pyrogram/pyrogram" rel="nofollow" class="fa fa-github"> View on GitHub</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="smart-plugins">
<h1>Smart Plugins<a class="headerlink" href="#smart-plugins" title="Permalink to this headline">¶</a></h1>
<p>Pyrogram embeds a <strong>smart</strong>, lightweight yet powerful plugin system that is meant to further simplify the organization
of large projects and to provide a way for creating pluggable (modular) components that can be <strong>easily shared</strong> across
different Pyrogram applications with <strong>minimal boilerplate code</strong>.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Smart Plugins are completely optional and disabled by default.</p>
</div>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Prior to the Smart Plugin system, pluggable handlers were already possible. For example, if you wanted to modularize
your applications, you had to put your function definitions in separate files and register them inside your main script
after importing your modules, like this:</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>This is an example application that replies in private chats with two messages: one containing the same
text message you sent and the other containing the reversed text message.</p>
<p class="last">Example: <em>“Pyrogram”</em> replies with <em>“Pyrogram”</em> and <em>“margoryP”</em></p>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>myproject/
    config.ini
    handlers.py
    main.py
</pre></div>
</div>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">handlers.py</span></code></p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">echo</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
    <span class="n">message</span><span class="o">.</span><span class="n">reply</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">echo_reversed</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
    <span class="n">message</span><span class="o">.</span><span class="n">reply</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">text</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">main.py</span></code></p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyrogram</span> <span class="kn">import</span> <span class="n">Client</span><span class="p">,</span> <span class="n">MessageHandler</span><span class="p">,</span> <span class="n">Filters</span>

<span class="kn">from</span> <span class="nn">handlers</span> <span class="kn">import</span> <span class="n">echo</span><span class="p">,</span> <span class="n">echo_reversed</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="s2">&quot;my_account&quot;</span><span class="p">)</span>

<span class="n">app</span><span class="o">.</span><span class="n">add_handler</span><span class="p">(</span>
    <span class="n">MessageHandler</span><span class="p">(</span>
        <span class="n">echo</span><span class="p">,</span>
        <span class="n">Filters</span><span class="o">.</span><span class="n">text</span> <span class="o">&amp;</span> <span class="n">Filters</span><span class="o">.</span><span class="n">private</span><span class="p">))</span>

<span class="n">app</span><span class="o">.</span><span class="n">add_handler</span><span class="p">(</span>
    <span class="n">MessageHandler</span><span class="p">(</span>
        <span class="n">echo_reversed</span><span class="p">,</span>
        <span class="n">Filters</span><span class="o">.</span><span class="n">text</span> <span class="o">&amp;</span> <span class="n">Filters</span><span class="o">.</span><span class="n">private</span><span class="p">),</span>
    <span class="n">group</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
<p>This is already nice and doesn’t add <em>too much</em> boilerplate code, but things can get boring still; you have to
manually <code class="docutils literal notranslate"><span class="pre">import</span></code>, manually <a class="reference internal" href="../pyrogram/Client.html#pyrogram.Client.add_handler" title="pyrogram.Client.add_handler"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_handler</span></code></a> and manually instantiate each
<a class="reference internal" href="../pyrogram/Handlers.html#pyrogram.MessageHandler" title="pyrogram.MessageHandler"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MessageHandler</span></code></a> object because <strong>you can’t use those cool decorators</strong> for your
functions. So, what if you could? Smart Plugins solve this issue by taking care of handlers registration automatically.</p>
</div>
<div class="section" id="using-smart-plugins">
<h2>Using Smart Plugins<a class="headerlink" href="#using-smart-plugins" title="Permalink to this headline">¶</a></h2>
<p>Setting up your Pyrogram project to accommodate Smart Plugins is pretty straightforward:</p>
<ol class="arabic simple">
<li>Create a new folder to store all the plugins (e.g.: “plugins”, “handlers”, …).</li>
<li>Put your python files full of plugins inside. Organize them as you wish.</li>
<li>Enable plugins in your Client or via the <em>config.ini</em> file.</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This is the same example application <a class="reference external" href="#introduction">as shown above</a>, written using the Smart Plugin system.</p>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>myproject/
<span class="hll">    plugins/
</span><span class="hll">        handlers.py
</span>    config.ini
    main.py
</pre></div>
</div>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">plugins/handlers.py</span></code></p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyrogram</span> <span class="kn">import</span> <span class="n">Client</span><span class="p">,</span> <span class="n">Filters</span>


<span class="hll"><span class="nd">@Client.on_message</span><span class="p">(</span><span class="n">Filters</span><span class="o">.</span><span class="n">text</span> <span class="o">&amp;</span> <span class="n">Filters</span><span class="o">.</span><span class="n">private</span><span class="p">)</span>
</span><span class="k">def</span> <span class="nf">echo</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
    <span class="n">message</span><span class="o">.</span><span class="n">reply</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>


<span class="hll"><span class="nd">@Client.on_message</span><span class="p">(</span><span class="n">Filters</span><span class="o">.</span><span class="n">text</span> <span class="o">&amp;</span> <span class="n">Filters</span><span class="o">.</span><span class="n">private</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span class="k">def</span> <span class="nf">echo_reversed</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
    <span class="n">message</span><span class="o">.</span><span class="n">reply</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">text</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">config.ini</span></code></p>
<blockquote>
<div><div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[plugins]</span>
<span class="na">root</span> <span class="o">=</span> <span class="s">plugins</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">main.py</span></code></p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyrogram</span> <span class="kn">import</span> <span class="n">Client</span>

<span class="n">Client</span><span class="p">(</span><span class="s2">&quot;my_account&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>Alternatively, without using the <em>config.ini</em> file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyrogram</span> <span class="kn">import</span> <span class="n">Client</span>

<span class="n">plugins</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="s2">&quot;plugins&quot;</span><span class="p">)</span>

<span class="n">Client</span><span class="p">(</span><span class="s2">&quot;my_account&quot;</span><span class="p">,</span> <span class="n">plugins</span><span class="o">=</span><span class="n">plugins</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
<p>The first important thing to note is the new <code class="docutils literal notranslate"><span class="pre">plugins</span></code> folder. You can put <em>any python file</em> in <em>any subfolder</em> and
each file can contain <em>any decorated function</em> (handlers) with one limitation: within a single module (file) you must
use different names for each decorated function.</p>
<p>The second thing is telling Pyrogram where to look for your plugins: you can either use the <em>config.ini</em> file or
the Client parameter “plugins”; the <em>root</em> value must match the name of your plugins root folder. Your Pyrogram Client
instance will <strong>automatically</strong> scan the folder upon starting to search for valid handlers and register them for you.</p>
<p>Then you’ll notice you can now use decorators. That’s right, you can apply the usual decorators to your callback
functions in a static way, i.e. <strong>without having the Client instance around</strong>: simply use <code class="docutils literal notranslate"><span class="pre">&#64;Client</span></code> (Client class)
instead of the usual <code class="docutils literal notranslate"><span class="pre">&#64;app</span></code> (Client instance) and things will work just the same.</p>
</div>
<div class="section" id="specifying-the-plugins-to-include">
<h2>Specifying the Plugins to include<a class="headerlink" href="#specifying-the-plugins-to-include" title="Permalink to this headline">¶</a></h2>
<p>By default, if you don’t explicitly supply a list of plugins, every valid one found inside your plugins root folder will
be included by following the alphabetical order of the directory structure (files and subfolders); the single handlers
found inside each module will be, instead, loaded in the order they are defined, from top to bottom.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Remember: there can be at most one handler, within a group, dealing with a specific update. Plugins with overlapping
filters included a second time will not work. Learn more at <a class="reference external" href="MoreOnUpdates.html">More on Updates</a>.</p>
</div>
<p>This default loading behaviour is usually enough, but sometimes you want to have more control on what to include (or
exclude) and in which exact order to load plugins. The way to do this is to make use of <code class="docutils literal notranslate"><span class="pre">include</span></code> and <code class="docutils literal notranslate"><span class="pre">exclude</span></code>
directives, either in the <em>config.ini</em> file or in the dictionary passed as Client argument. Here’s how they work:</p>
<ul class="simple">
<li>If both <code class="docutils literal notranslate"><span class="pre">include</span></code> and <code class="docutils literal notranslate"><span class="pre">exclude</span></code> are omitted, all plugins are loaded as described above.</li>
<li>If <code class="docutils literal notranslate"><span class="pre">include</span></code> is given, only the specified plugins will be loaded, in the order they are passed.</li>
<li>If <code class="docutils literal notranslate"><span class="pre">exclude</span></code> is given, the plugins specified here will be unloaded.</li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">include</span></code> and <code class="docutils literal notranslate"><span class="pre">exclude</span></code> value is a <strong>list of strings</strong>. Each string containing the path of the module relative
to the plugins root folder, in Python notation (dots instead of slashes).</p>
<blockquote>
<div>E.g.: <code class="docutils literal notranslate"><span class="pre">subfolder.module</span></code> refers to <code class="docutils literal notranslate"><span class="pre">plugins/subfolder/module.py</span></code>, with <code class="docutils literal notranslate"><span class="pre">root=&quot;plugins&quot;</span></code>.</div></blockquote>
<p>You can also choose the order in which the single handlers inside a module are loaded, thus overriding the default
top-to-bottom loading policy. You can do this by appending the name of the functions to the module path, each one
separated by a blank space.</p>
<blockquote>
<div>E.g.: <code class="docutils literal notranslate"><span class="pre">subfolder.module</span> <span class="pre">fn2</span> <span class="pre">fn1</span> <span class="pre">fn3</span></code> will load <em>fn2</em>, <em>fn1</em> and <em>fn3</em> from <em>subfolder.module</em>, in this order.</div></blockquote>
<div class="section" id="examples">
<h3>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h3>
<p>Given this plugins folder structure with three modules, each containing their own handlers (fn1, fn2, etc…), which are
also organized in subfolders:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>myproject/
    plugins/
        subfolder1/
            plugins1.py
                - fn1
                - fn2
                - fn3
        subfolder2/
            plugins2.py
                ...
        plugins0.py
            ...
    ...
</pre></div>
</div>
<ul>
<li><p class="first">Load every handler from every module, namely <em>plugins0.py</em>, <em>plugins1.py</em> and <em>plugins2.py</em> in alphabetical order
(files) and definition order (handlers inside files):</p>
<blockquote>
<div><p>Using <em>config.ini</em> file:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[plugins]</span>
<span class="na">root</span> <span class="o">=</span> <span class="s">plugins</span>
</pre></div>
</div>
<p>Using <em>Client</em>’s parameter:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plugins</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="s2">&quot;plugins&quot;</span><span class="p">)</span>

<span class="n">Client</span><span class="p">(</span><span class="s2">&quot;my_account&quot;</span><span class="p">,</span> <span class="n">plugins</span><span class="o">=</span><span class="n">plugins</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Load only handlers defined inside <em>plugins2.py</em> and <em>plugins0.py</em>, in this order:</p>
<blockquote>
<div><p>Using <em>config.ini</em> file:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[plugins]</span>
<span class="na">root</span> <span class="o">=</span> <span class="s">plugins</span>
<span class="na">include</span> <span class="o">=</span><span class="s"></span>
<span class="s">    subfolder2.plugins2</span>
<span class="s">    plugins0</span>
</pre></div>
</div>
<p>Using <em>Client</em>’s parameter:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plugins</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">root</span><span class="o">=</span><span class="s2">&quot;plugins&quot;</span><span class="p">,</span>
    <span class="n">include</span><span class="o">=</span><span class="p">[</span>
        <span class="s2">&quot;subfolder2.plugins2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;plugins0&quot;</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="n">Client</span><span class="p">(</span><span class="s2">&quot;my_account&quot;</span><span class="p">,</span> <span class="n">plugins</span><span class="o">=</span><span class="n">plugins</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Load everything except the handlers inside <em>plugins2.py</em>:</p>
<blockquote>
<div><p>Using <em>config.ini</em> file:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[plugins]</span>
<span class="na">root</span> <span class="o">=</span> <span class="s">plugins</span>
<span class="na">exclude</span> <span class="o">=</span> <span class="s">subfolder2.plugins2</span>
</pre></div>
</div>
<p>Using <em>Client</em>’s parameter:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plugins</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">root</span><span class="o">=</span><span class="s2">&quot;plugins&quot;</span><span class="p">,</span>
    <span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;subfolder2.plugins2&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">Client</span><span class="p">(</span><span class="s2">&quot;my_account&quot;</span><span class="p">,</span> <span class="n">plugins</span><span class="o">=</span><span class="n">plugins</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Load only <em>fn3</em>, <em>fn1</em> and <em>fn2</em> (in this order) from <em>plugins1.py</em>:</p>
<blockquote>
<div><p>Using <em>config.ini</em> file:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[plugins]</span>
<span class="na">root</span> <span class="o">=</span> <span class="s">plugins</span>
<span class="na">include</span> <span class="o">=</span> <span class="s">subfolder1.plugins1 fn3 fn1 fn2</span>
</pre></div>
</div>
<p>Using <em>Client</em>’s parameter:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plugins</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">root</span><span class="o">=</span><span class="s2">&quot;plugins&quot;</span><span class="p">,</span>
    <span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;subfolder1.plugins1 fn3 fn1 fn2&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">Client</span><span class="p">(</span><span class="s2">&quot;my_account&quot;</span><span class="p">,</span> <span class="n">plugins</span><span class="o">=</span><span class="n">plugins</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</div>
</div>
<div class="section" id="load-unload-plugins-at-runtime">
<h2>Load/Unload Plugins at Runtime<a class="headerlink" href="#load-unload-plugins-at-runtime" title="Permalink to this headline">¶</a></h2>
<p>In the <a class="reference external" href="#specifying-the-plugins-to-include">previous section</a> we’ve explained how to specify which plugins to load and
which to ignore before your Client starts. Here we’ll show, instead, how to unload and load again a previously
registered plugin at runtime.</p>
<p>Each function decorated with the usual <code class="docutils literal notranslate"><span class="pre">on_message</span></code> decorator (or any other decorator that deals with Telegram updates
) will be modified in such a way that, when you reference them later on, they will be actually pointing to a tuple of
<em>(handler: Handler, group: int)</em>. The actual callback function is therefore stored inside the handler’s <em>callback</em>
attribute. Here’s an example:</p>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">plugins/handlers.py</span></code></p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@Client.on_message</span><span class="p">(</span><span class="n">Filters</span><span class="o">.</span><span class="n">text</span> <span class="o">&amp;</span> <span class="n">Filters</span><span class="o">.</span><span class="n">private</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">echo</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
    <span class="n">message</span><span class="o">.</span><span class="n">reply</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

<span class="hll"><span class="k">print</span><span class="p">(</span><span class="n">echo</span><span class="p">)</span>
</span><span class="hll"><span class="k">print</span><span class="p">(</span><span class="n">echo</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">callback</span><span class="p">)</span>
</span></pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Printing <code class="docutils literal notranslate"><span class="pre">echo</span></code> will show something like <code class="docutils literal notranslate"><span class="pre">(&lt;MessageHandler</span> <span class="pre">object</span> <span class="pre">at</span> <span class="pre">0x10e3abc50&gt;,</span> <span class="pre">0)</span></code>.</p>
</li>
<li><p class="first">Printing <code class="docutils literal notranslate"><span class="pre">echo[0].callback</span></code>, that is, the <em>callback</em> attribute of the first element of the tuple, which is an
Handler, will reveal the actual callback <code class="docutils literal notranslate"><span class="pre">&lt;function</span> <span class="pre">echo</span> <span class="pre">at</span> <span class="pre">0x10e3b6598&gt;</span></code>.</p>
</li>
</ul>
<div class="section" id="unloading">
<h3>Unloading<a class="headerlink" href="#unloading" title="Permalink to this headline">¶</a></h3>
<p>In order to unload a plugin, or any other handler, all you need to do is obtain a reference to it by importing the
relevant module and call <a class="reference internal" href="../pyrogram/Client.html#pyrogram.Client.remove_handler" title="pyrogram.Client.remove_handler"><code class="xref py py-meth docutils literal notranslate"><span class="pre">remove_handler()</span></code></a> Client’s method with your function
name preceded by the star <code class="docutils literal notranslate"><span class="pre">*</span></code> operator as argument. Example:</p>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">main.py</span></code></p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">plugins.handlers</span> <span class="kn">import</span> <span class="n">echo</span>

<span class="o">...</span>

<span class="n">app</span><span class="o">.</span><span class="n">remove_handler</span><span class="p">(</span><span class="o">*</span><span class="n">echo</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
<p>The star <code class="docutils literal notranslate"><span class="pre">*</span></code> operator is used to unpack the tuple into positional arguments so that <em>remove_handler</em> will receive
exactly what is needed. The same could have been achieved with:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">handler</span><span class="p">,</span> <span class="n">group</span> <span class="o">=</span> <span class="n">echo</span>
<span class="n">app</span><span class="o">.</span><span class="n">remove_handler</span><span class="p">(</span><span class="n">handler</span><span class="p">,</span> <span class="n">group</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="loading">
<h3>Loading<a class="headerlink" href="#loading" title="Permalink to this headline">¶</a></h3>
<p>Similarly to the unloading process, in order to load again a previously unloaded plugin you do the same, but this time
using <a class="reference internal" href="../pyrogram/Client.html#pyrogram.Client.add_handler" title="pyrogram.Client.add_handler"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_handler()</span></code></a> instead. Example:</p>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">main.py</span></code></p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">plugins.handlers</span> <span class="kn">import</span> <span class="n">echo</span>

<span class="o">...</span>

<span class="n">app</span><span class="o">.</span><span class="n">add_handler</span><span class="p">(</span><span class="o">*</span><span class="n">echo</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="AutoAuthorization.html" class="btn btn-neutral float-right" title="Auto Authorization" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="ConfigurationFile.html" class="btn btn-neutral" title="Configuration File" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    <div>
      <b><a href="https://github.com/pyrogram/pyrogram">Pyrogram</a></b> documentation
      &copy; Copyright 2017-2019, Dan Tès
    </div>
    <p>
      Licensed under the
      <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>
    </p>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a modified <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'version 0.12.0',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/language_data.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          
          SphinxRtdTheme.Navigation.enable();
          
      });
  </script> 

</body>
</html>